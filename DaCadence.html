<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DaCadence Attendance</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f7f9;
            color: #333;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        header {
            background: #6a11cb;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 20px;
            text-align: center;
        }
        h1 {
            margin: 0;
            font-size: 28px;
        }
        .subtitle {
            font-style: italic;
            margin-top: 5px;
        }
        .instructions {
            background-color: #f0f4ff;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }
        .sheet-content {
            overflow-x: auto;
            padding: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 800px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f0f4ff;
            position: sticky;
            top: 0;
            font-weight: 600;
        }
        .name-col {
            text-align: left;
            background-color: #f7f9ff;
            font-weight: 500;
            min-width: 150px;
            position: relative;
        }
        .date-col {
            min-width: 100px;
            background-color: #f0f7ff;
            cursor: pointer;
            position: relative;
        }
        .date-col:hover {
            background-color: #e0e7ff;
        }
        .event-type {
            font-size: 10px;
            color: #666;
            display: block;
            margin-top: 3px;
        }
        .attendance-cell {
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            color: #2e7d32;
            position: relative;
        }
        .absent {
            color: #c62828;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .summary h3 {
            margin-top: 0;
            color: #6a11cb;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            padding: 0 20px;
        }
        button {
            padding: 10px 15px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }
        button:hover {
            background: #5a0fb8;
        }
        input, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .absence-count {
            font-weight: bold;
            color: #c62828;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
        }
        .modal h3 {
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
        }
        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .time-inputs span {
            font-weight: bold;
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .secondary-btn {
            background: #ddd;
            color: #333;
        }
        .delete-btn {
            background: #c62828;
        }
        .delete-btn:hover {
            background: #b71c1c;
        }
        .event-rehearsal {
            background-color: #e8f5e9;
        }
        .event-performance {
            background-color: #fff3e0;
        }
        .event-party {
            background-color: #fce4ec;
        }
        .edit-icon {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            opacity: 0.6;
        }
        .delete-member-btn {
            display: none;
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            color: #999;
            border: none;
            font-size: 14px;
            padding: 2px 5px;
            cursor: pointer;
        }
        .name-col:hover .delete-member-btn {
            display: block;
        }
        .delete-member-btn:hover {
            color: #c62828;
        }
        .event-details-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .event-details-content {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            width: 450px;
            max-width: 90%;
        }
        .event-details-content h3 {
            margin-top: 0;
            color: #6a11cb;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        .event-info {
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .event-info p {
            margin: 8px 0;
        }
        .event-info strong {
            display: inline-block;
            width: 100px;
            color: #555;
        }
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            .controls > * {
                width: 100%;
            }
            .time-inputs {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        .export-import {
            margin-top: 20px;
            padding: 0 20px;
        }
        .export-import-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .data-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DaCadence Attendance</h1>
        </header>
        
        <div class="instructions">
            <p>Click on a cell to mark attendance: Click once for ✓ (present), click again for X (absent), click again to clear. Click on a date header to view event details. Hover over a member's name to see the delete button.</p>
        </div>
        
        <div class="controls">
            <button id="add-date">Add New Date</button>
            <button id="add-member">Add New Member</button>
        </div>
        
        <div class="sheet-content">
            <table id="attendance-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <!-- Dates will be inserted here by JavaScript -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Attendance data will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="summary">
            <h3>Absence Count</h3>
            <table id="absence-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Total Absences</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Absence data will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="export-import">
            <h3>Data Management</h3>
            <div class="export-import-buttons">
                <button id="export-data">Export Data</button>
                <button id="import-data">Import Data</button>
                <button id="clear-data" class="delete-btn">Clear All Data</button>
            </div>
            <p class="data-info">Your data is automatically saved to your browser's local storage.</p>
        </div>
    </div>

    <!-- Modal for adding/editing dates -->
    <div class="modal" id="date-modal">
        <div class="modal-content">
            <h3 id="modal-title">Add New Date</h3>
            <div class="form-group">
                <label for="modal-date">Date</label>
                <input type="date" id="modal-date">
            </div>
            <div class="form-group">
                <label for="modal-event-type">Event Type</label>
                <select id="modal-event-type">
                    <option value="rehearsal">Rehearsal</option>
                    <option value="performance">Performance</option>
                    <option value="party">Party</option>
                </select>
            </div>
            <div class="form-group">
                <label for="modal-time">Time Period</label>
                <div class="time-inputs">
                    <input type="time" id="modal-start-time">
                    <span>to</span>
                    <input type="time" id="modal-end-time">
                </div>
            </div>
            <div class="form-group">
                <label for="modal-location">Location</label>
                <input type="text" id="modal-location" placeholder="e.g., Main Hall, Studio B">
            </div>
            <div class="form-group">
                <label for="modal-notes">Notes (optional)</label>
                <textarea id="modal-notes" placeholder="e.g., Bring music sheets, Dress rehearsal" rows="3"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="secondary-btn" id="modal-cancel">Cancel</button>
                <button id="modal-delete" class="delete-btn">Delete</button>
                <button id="modal-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing event details -->
    <div class="event-details-modal" id="event-details-modal">
        <div class="event-details-content">
            <h3 id="event-details-title">Event Details</h3>
            <div class="event-info" id="event-info">
                <!-- Event details will be inserted here -->
            </div>
            <div class="modal-buttons">
                <button class="secondary-btn" id="event-details-close">Close</button>
                <button id="event-details-edit">Edit</button>
                <button id="event-details-delete" class="delete-btn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Modal for adding members -->
    <div class="modal" id="member-modal">
        <div class="modal-content">
            <h3>Add New Member</h3>
            <div class="form-group">
                <label for="modal-member-name">Name</label>
                <input type="text" id="modal-member-name" placeholder="Enter member name">
            </div>
            <div class="modal-buttons">
                <button class="secondary-btn" id="member-modal-cancel">Cancel</button>
                <button id="member-modal-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="import-file" accept=".json" style="display: none;">

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data from localStorage or use defaults
            let members = JSON.parse(localStorage.getItem('dacadence_members')) || [
                { id: 'member-1', name: 'Willa' },
                { id: 'member-2', name: 'Catherine' },
                { id: 'member-3', name: 'Sadie' },
                { id: 'member-4', name: 'Taylor' },
                { id: 'member-5', name: 'Charles' },
                { id: 'member-6', name: 'Matthew' },
                { id: 'member-7', name: 'Sarah' },
                { id: 'member-8', name: 'Jamie' },
                { id: 'member-9', name: 'Shravan' }
            ];
            
            let dates = JSON.parse(localStorage.getItem('dacadence_dates')) || [];
            // Convert date strings back to Date objects
            dates = dates.map(date => ({
                ...date,
                date: new Date(date.date)
            }));
            
            let attendanceData = JSON.parse(localStorage.getItem('dacadence_attendance')) || {};
            
            // Initialize empty attendance data for new members
            members.forEach(member => {
                if (!attendanceData[member.id]) {
                    attendanceData[member.id] = {};
                }
            });
            
            // DOM elements
            const dateModal = document.getElementById('date-modal');
            const eventDetailsModal = document.getElementById('event-details-modal');
            const memberModal = document.getElementById('member-modal');
            const deleteBtn = document.getElementById('modal-delete');
            const importFileInput = document.getElementById('import-file');
            let currentEditingDateId = null;
            
            // Save data to localStorage
            function saveToLocalStorage() {
                // Convert dates to string format for storage
                const datesForStorage = dates.map(date => ({
                    ...date,
                    date: date.date.toISOString()
                }));
                
                localStorage.setItem('dacadence_members', JSON.stringify(members));
                localStorage.setItem('dacadence_dates', JSON.stringify(datesForStorage));
                localStorage.setItem('dacadence_attendance', JSON.stringify(attendanceData));
            }
            
            // Render the table
            function renderTable() {
                const tableHead = document.querySelector('#attendance-table thead tr');
                const tableBody = document.querySelector('#attendance-table tbody');
                
                // Clear existing content
                tableHead.innerHTML = '<th>Name</th>';
                tableBody.innerHTML = '';
                
                // Add date headers if we have dates
                if (dates.length > 0) {
                    dates.forEach(date => {
                        const dateHeader = document.createElement('th');
                        dateHeader.innerHTML = `
                            ${formatDate(date.date)}
                            <span class="event-type">${date.type.charAt(0).toUpperCase()}</span>
                            <span class="edit-icon">✎</span>
                        `;
                        dateHeader.className = `date-col event-${date.type}`;
                        dateHeader.setAttribute('data-date-id', date.id);
                        
                        // Add click event to view event details
                        dateHeader.addEventListener('click', function() {
                            showEventDetails(date.id);
                        });
                        
                        tableHead.appendChild(dateHeader);
                    });
                } else {
                    // Add a placeholder if no dates
                    const placeholderHeader = document.createElement('th');
                    placeholderHeader.textContent = "No dates added yet. Click 'Add New Date' to get started.";
                    placeholderHeader.colSpan = 1;
                    placeholderHeader.style.padding = '20px';
                    placeholderHeader.style.fontStyle = 'italic';
                    placeholderHeader.style.color = '#666';
                    tableHead.appendChild(placeholderHeader);
                }
                
                // Add member rows
                members.forEach(member => {
                    const row = document.createElement('tr');
                    
                    // Member name cell
                    const nameCell = document.createElement('td');
                    nameCell.className = 'name-col';
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = member.name;
                    nameCell.appendChild(nameSpan);
                    
                    // Add delete button for member
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'delete-member-btn';
                    deleteButton.innerHTML = '×';
                    deleteButton.title = 'Delete member';
                    deleteButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        deleteMember(member.id);
                    });
                    nameCell.appendChild(deleteButton);
                    
                    row.appendChild(nameCell);
                    
                    // Attendance cells if we have dates
                    if (dates.length > 0) {
                        dates.forEach(date => {
                            const cell = document.createElement('td');
                            cell.textContent = attendanceData[member.id][date.id] || '';
                            cell.className = 'attendance-cell';
                            if (cell.textContent === 'X') {
                                cell.classList.add('absent');
                            }
                            cell.setAttribute('data-member', member.id);
                            cell.setAttribute('data-date', date.id);
                            
                            // Add click event to cycle through attendance states
                            cell.addEventListener('click', function() {
                                const current = this.textContent;
                                if (current === '') {
                                    this.textContent = '✓';
                                    this.classList.remove('absent');
                                    attendanceData[member.id][date.id] = '✓';
                                } else if (current === '✓') {
                                    this.textContent = 'X';
                                    this.classList.add('absent');
                                    attendanceData[member.id][date.id] = 'X';
                                } else {
                                    this.textContent = '';
                                    this.classList.remove('absent');
                                    attendanceData[member.id][date.id] = '';
                                }
                                updateAbsenceSummary();
                                saveToLocalStorage();
                            });
                            
                            row.appendChild(cell);
                        });
                    }
                    
                    tableBody.appendChild(row);
                });
                
                updateAbsenceSummary();
            }
            
            // Format date for display
            function formatDate(date) {
                return date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric'
                });
            }
            
            // Format time for display
            function formatTime(timeString) {
                if (!timeString) return '';
                
                const [hours, minutes] = timeString.split(':');
                const hour = parseInt(hours);
                const ampm = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour % 12 || 12;
                
                return `${displayHour}:${minutes} ${ampm}`;
            }
            
            // Update absence summary
            function updateAbsenceSummary() {
                const absenceTable = document.querySelector('#absence-table tbody');
                absenceTable.innerHTML = '';
                
                members.forEach(member => {
                    const row = document.createElement('tr');
                    
                    // Member name cell
                    const nameCell = document.createElement('td');
                    nameCell.textContent = member.name;
                    nameCell.className = 'name-col';
                    row.appendChild(nameCell);
                    
                    // Absence count cell
                    const absenceCell = document.createElement('td');
                    let absenceCount = 0;
                    
                    dates.forEach(date => {
                        if (attendanceData[member.id][date.id] === 'X') {
                            absenceCount++;
                        }
                    });
                    
                    absenceCell.innerHTML = `<span class="absence-count">${absenceCount}</span>`;
                    row.appendChild(absenceCell);
                    
                    absenceTable.appendChild(row);
                });
            }
            
            // Show event details
            function showEventDetails(dateId) {
                const date = dates.find(d => d.id === dateId);
                if (!date) return;
                
                const eventInfo = document.getElementById('event-info');
                const eventDetailsTitle = document.getElementById('event-details-title');
                
                eventDetailsTitle.textContent = `${date.type.charAt(0).toUpperCase() + date.type.slice(1)} Details`;
                
                let detailsHTML = `
                    <p><strong>Date:</strong> ${date.date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    <p><strong>Type:</strong> ${date.type.charAt(0).toUpperCase() + date.type.slice(1)}</p>
                `;
                
                if (date.startTime && date.endTime) {
                    detailsHTML += `<p><strong>Time:</strong> ${formatTime(date.startTime)} - ${formatTime(date.endTime)}</p>`;
                }
                
                if (date.location) {
                    detailsHTML += `<p><strong>Location:</strong> ${date.location}</p>`;
                }
                
                if (date.notes) {
                    detailsHTML += `<p><strong>Notes:</strong> ${date.notes}</p>`;
                }
                
                eventInfo.innerHTML = detailsHTML;
                
                // Set up event handlers for the buttons
                document.getElementById('event-details-edit').onclick = function() {
                    eventDetailsModal.style.display = 'none';
                    openEditDateModal(dateId);
                };
                
                document.getElementById('event-details-delete').onclick = function() {
                    eventDetailsModal.style.display = 'none';
                    deleteDate(dateId);
                };
                
                eventDetailsModal.style.display = 'flex';
            }
            
            // Delete a member
            function deleteMember(memberId) {
                if (confirm('Are you sure you want to delete this member? All attendance data for this member will be lost.')) {
                    // Remove member from members array
                    const memberIndex = members.findIndex(m => m.id === memberId);
                    if (memberIndex !== -1) {
                        members.splice(memberIndex, 1);
                    }
                    
                    // Remove attendance data for this member
                    delete attendanceData[memberId];
                    
                    renderTable();
                    saveToLocalStorage();
                }
            }
            
            // Open modal to add/edit date
            function openEditDateModal(dateId = null) {
                currentEditingDateId = dateId;
                const modalTitle = document.getElementById('modal-title');
                const modalDate = document.getElementById('modal-date');
                const modalEventType = document.getElementById('modal-event-type');
                const modalStartTime = document.getElementById('modal-start-time');
                const modalEndTime = document.getElementById('modal-end-time');
                const modalLocation = document.getElementById('modal-location');
                const modalNotes = document.getElementById('modal-notes');
                
                // Show or hide delete button based on whether we're editing
                if (dateId) {
                    deleteBtn.style.display = 'block';
                    modalTitle.textContent = 'Edit Event';
                    const date = dates.find(d => d.id === dateId);
                    modalDate.value = formatDateForInput(date.date);
                    modalEventType.value = date.type;
                    modalStartTime.value = date.startTime || '';
                    modalEndTime.value = date.endTime || '';
                    modalLocation.value = date.location || '';
                    modalNotes.value = date.notes || '';
                } else {
                    deleteBtn.style.display = 'none';
                    modalTitle.textContent = 'Add New Date';
                    // Set default date to today
                    const today = new Date();
                    modalDate.value = formatDateForInput(today);
                    modalEventType.value = 'rehearsal';
                    modalStartTime.value = '19:00';
                    modalEndTime.value = '21:00';
                    modalLocation.value = '';
                    modalNotes.value = '';
                }
                
                dateModal.style.display = 'flex';
            }
            
            // Format date for input[type="date"]
            function formatDateForInput(date) {
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            
            // Save date from modal
            function saveDate() {
                const modalDate = document.getElementById('modal-date');
                const modalEventType = document.getElementById('modal-event-type');
                const modalStartTime = document.getElementById('modal-start-time');
                const modalEndTime = document.getElementById('modal-end-time');
                const modalLocation = document.getElementById('modal-location');
                const modalNotes = document.getElementById('modal-notes');
                
                if (!modalDate.value) {
                    alert('Please select a date');
                    return;
                }
                
                // Validate time inputs
                if (modalStartTime.value && !modalEndTime.value) {
                    alert('Please provide an end time');
                    return;
                }
                
                if (!modalStartTime.value && modalEndTime.value) {
                    alert('Please provide a start time');
                    return;
                }
                
                // Fix for date parsing - create date from input value
                const dateObj = new Date(modalDate.value + 'T00:00:00'); // Add time to avoid timezone issues

                if (currentEditingDateId) {
                    // Update existing date
                    const dateIndex = dates.findIndex(d => d.id === currentEditingDateId);
                    if (dateIndex !== -1) {
                        dates[dateIndex].date = dateObj;
                        dates[dateIndex].type = modalEventType.value;
                        dates[dateIndex].startTime = modalStartTime.value;
                        dates[dateIndex].endTime = modalEndTime.value;
                        dates[dateIndex].location = modalLocation.value;
                        dates[dateIndex].notes = modalNotes.value;
                    }
                } else {
                    // Add new date
                    const dateId = `date-${Date.now()}`;
                    dates.push({
                        id: dateId,
                        date: dateObj,
                        type: modalEventType.value,
                        startTime: modalStartTime.value,
                        endTime: modalEndTime.value,
                        location: modalLocation.value,
                        notes: modalNotes.value
                    });
                    
                    // Initialize attendance data for all members for this new date
                    members.forEach(member => {
                        attendanceData[member.id][dateId] = '';
                    });
                }
                
                renderTable();
                dateModal.style.display = 'none';
                saveToLocalStorage();
            }
            
            // Delete date
            function deleteDate(dateId = null) {
                const targetDateId = dateId || currentEditingDateId;
                if (!targetDateId) return;
                
                if (confirm('Are you sure you want to delete this date? All attendance data for this date will be lost.')) {
                    // Remove date from dates array
                    const dateIndex = dates.findIndex(d => d.id === targetDateId);
                    if (dateIndex !== -1) {
                        dates.splice(dateIndex, 1);
                    }
                    
                    // Remove attendance data for this date from all members
                    members.forEach(member => {
                        delete attendanceData[member.id][targetDateId];
                    });
                    
                    renderTable();
                    dateModal.style.display = 'none';
                    eventDetailsModal.style.display = 'none';
                    saveToLocalStorage();
                }
            }
            
            // Open modal to add member
            function openAddMemberModal() {
                document.getElementById('modal-member-name').value = '';
                memberModal.style.display = 'flex';
            }
            
            // Save member from modal
            function saveMember() {
                const memberName = document.getElementById('modal-member-name').value.trim();
                
                if (!memberName) {
                    alert('Please enter a name for the member');
                    return;
                }
                
                const memberId = `member-${Date.now()}`;
                members.push({
                    id: memberId,
                    name: memberName
                });
                
                // Initialize attendance data for this new member for all dates
                attendanceData[memberId] = {};
                dates.forEach(date => {
                    attendanceData[memberId][date.id] = '';
                });
                
                renderTable();
                memberModal.style.display = 'none';
                saveToLocalStorage();
            }
            
            // Export data
            function exportData() {
                const data = {
                    members,
                    dates: dates.map(date => ({
                        ...date,
                        date: date.date.toISOString()
                    })),
                    attendanceData
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'dacadence_attendance.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }
            
            // Import data
            function importData() {
                importFileInput.click();
            }
            
            // Handle file import
            importFileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('Importing data will replace all current data. Are you sure?')) {
                            members = data.members;
                            dates = data.dates.map(date => ({
                                ...date,
                                date: new Date(date.date)
                            }));
                            attendanceData = data.attendanceData;
                            
                            renderTable();
                            saveToLocalStorage();
                            alert('Data imported successfully!');
                        }
                    } catch (error) {
                        alert('Error importing data: Invalid file format');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
                
                // Reset the file input
                event.target.value = '';
            });
            
            // Clear all data
            function clearAllData() {
                if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                    localStorage.removeItem('dacadence_members');
                    localStorage.removeItem('dacadence_dates');
                    localStorage.removeItem('dacadence_attendance');
                    
                    // Reset to default data
                    members = [
                        { id: 'member-1', name: 'Willa' },
                        { id: 'member-2', name: 'Catherine' },
                        { id: 'member-3', name: 'Sadie' },
                        { id: 'member-4', name: 'Taylor' },
                        { id: 'member-5', name: 'Charles' },
                        { id: 'member-6', name: 'Matthew' },
                        { id: 'member-7', name: 'Sarah' },
                        { id: 'member-8', name: 'Jamie' },
                        { id: 'member-9', name: 'Shravan' }
                    ];
                    
                    dates = [];
                    attendanceData = {};
                    
                    members.forEach(member => {
                        attendanceData[member.id] = {};
                    });
                    
                    renderTable();
                    saveToLocalStorage();
                    alert('All data has been cleared.');
                }
            }
            
            // Event listeners
            document.getElementById('add-date').addEventListener('click', function() {
                openEditDateModal();
            });
            
            document.getElementById('add-member').addEventListener('click', function() {
                openAddMemberModal();
            });
            
            document.getElementById('export-data').addEventListener('click', exportData);
            document.getElementById('import-data').addEventListener('click', importData);
            document.getElementById('clear-data').addEventListener('click', clearAllData);
            
            document.getElementById('modal-save').addEventListener('click', saveDate);
            document.getElementById('modal-cancel').addEventListener('click', function() {
                dateModal.style.display = 'none';
            });
            
            document.getElementById('modal-delete').addEventListener('click', function() {
                deleteDate();
            });
            
            document.getElementById('member-modal-save').addEventListener('click', saveMember);
            document.getElementById('member-modal-cancel').addEventListener('click', function() {
                memberModal.style.display = 'none';
            });
            
            document.getElementById('event-details-close').addEventListener('click', function() {
                eventDetailsModal.style.display = 'none';
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === dateModal) {
                    dateModal.style.display = 'none';
                }
                if (event.target === eventDetailsModal) {
                    eventDetailsModal.style.display = 'none';
                }
                if (event.target === memberModal) {
                    memberModal.style.display = 'none';
                }
            });
            
            // Initialize the table
            renderTable();
        });
    </script>
</body>
</html>
